<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini OCR Web App (Debug Ver.)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; background: #f0f2f5; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        button { background: #0071e3; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
        textarea { width: 100%; height: 300px; border: 1px solid #ccc; border-radius: 5px; padding: 10px; font-size: 14px; }
        #status { padding: 10px; margin: 10px 0; border-radius: 5px; font-weight: bold; }
        .loading { background: #e3f2fd; color: #0d47a1; border: 1px solid #bbdefb; }
        .error { background: #ffebee; color: #c62828; border: 1px solid #ffcdd2; }
        .success { background: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }
    </style>
</head>
<body>

    <h2>Gemini OCR Web App</h2>

    <div class="card">
        <strong>1. APIキー</strong><br>
        <input type="password" id="apiKey" style="width:70%; padding:5px;">
        <button onclick="saveKey()">保存</button>
    </div>

    <div class="card">
        <strong>2. PDF選択</strong><br>
        <input type="file" id="pdfFile" accept="application/pdf">
        <button id="startBtn">OCRを開始する</button>
    </div>

    <div id="status">ここに現在の状況が表示されます</div>

    <div class="card">
        <strong>3. 結果</strong><br>
        <textarea id="result"></textarea>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

        // PDF.jsの設定
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        const status = document.getElementById('status');
        const resultArea = document.getElementById('result');

        window.saveKey = () => {
            const key = document.getElementById('apiKey').value;
            localStorage.setItem('gemini_api_key', key);
            alert('保存しました');
        };

        const updateStatus = (msg, type = 'loading') => {
            status.innerText = msg;
            status.className = type;
        };

        document.getElementById('startBtn').onclick = async () => {
            const file = document.getElementById('pdfFile').files[0];
            const key = localStorage.getItem('gemini_api_key') || document.getElementById('apiKey').value;

            if (!file || !key) {
                updateStatus("エラー:
